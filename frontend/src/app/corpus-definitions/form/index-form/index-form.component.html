<h1 class="title">Index data</h1>

<p class="subtitle">
    Create a search index and activate your corpus
</p>

<ng-container *ngIf="state$ | async as state">
    <div [ngSwitch]="state.status" class="content">
        <ng-container *ngSwitchCase="'no connection'">
            <p>
                Cannot fetch status due to a connection issue. Please try again later,
                or contact an administrator if you keep seeing this message.
            </p>
        </ng-container>

        <ng-container *ngSwitchCase="'index required'">
            <p [ngSwitch]="state.reason">
                <ng-container *ngSwitchCase="'no index'">
                    Your corpus has not yet been indexed.
                </ng-container>
                <ng-container *ngSwitchCase="'outdated data'">
                    The latest data file for your corpus has not yet been indexed.
                </ng-container>
                <ng-container *ngSwitchCase="'outdated configuration'">
                    Your corpus must be re-indexed to reflect your latest changes.
                </ng-container>
                <ng-container *ngSwitchCase="'job cancelled'">
                    The indexing process was aborted, and needs to be restarted.
                </ng-container>
            </p>
            <p>
                To make your corpus searchable, start the indexing proccess below.
                Depending on the amount of data, this can take a while.
            </p>
            <button class="button" (click)="startIndex()">Start indexing</button>
        </ng-container>

        <ng-container *ngSwitchCase="'working'">
            <p>Your data is being indexed...</p>
        </ng-container>

        <ng-container *ngSwitchCase="'index ready'">
            <p>
                Your data data is indexed and ready to be searched!
            </p>
            <p *ngIf="!corpus.active">
                You can activate your corpus now to start searching. Once the corpus is
                active, most of the fields in this form will be locked; you can
                de-activate the corpus to start editing again.
            </p>
            <p *ngIf="corpus.active">
                Your corpus is now active and available for searching. While the corpus
                is active, most of the fields in this form are locked; you can de-activate
                the corpus to start editing again.
            </p>

            <div class="field is-grouped">
                <div class="control">
                    <button class="button" (click)="toggleCorpusActive()"
                        [class.is-primary]="!corpus.active">
                        {{corpus.active ? 'Deactivate' : 'Activate'}} corpus
                    </button>
                </div>
                <div class="control">
                    <a class="button is-primary" *ngIf="corpus.active"
                        [routerLink]="['/search', corpus.definition.name]">
                        Search corpus
                    </a>
                </div>
            </div>
        </ng-container>

        <ng-container *ngSwitchCase="'index failed'">
            <p>
                Something went wrong while indexing your data. Please contact an
                administrator.
            </p>
        </ng-container>

        <ng-container *ngSwitchCase="'corpus invalid'">
            <p>
                Your corpus is not yet ready for indexing.
            </p>

            <p><b>Reason:</b> {{state.reason}}</p>
        </ng-container>
    </div>
</ng-container>
