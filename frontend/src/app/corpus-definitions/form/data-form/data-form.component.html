<h1 class="title">Upload a sample of your data</h1>
<p class="subtitle">Determines sensible default values for the fields of your corpus</p>

<button class="button" (click)="openDocumentation()">Manual</button>

<ng-container *ngIf="!fileUploaded()">
    <p>You have not uploaded a data file yet.</p>
</ng-container>

<ng-container *ngIf="fileUploaded() && (fileInfo$ | async) as fileInfo">
    <ia-datafile-info [currentFileInfo]="fileInfo" [currentDataFile]="dataFile" />
    <p>If this is what you expected, click "use this file" to base your corpus on this data file.</p>
    <p>In the next step, you can configure the fields in more detail.</p>
    <p>If this does not seem correct, please consult the manual and make sure the file is formatted correctly.</p>
    <p>You can use "reset" to remove your data file, or "replace" to upload a different one. </p>
</ng-container>

<ng-template #currentFileMenu>
    <div class="field is-grouped">
        <button class="button" (click)="resetFile()">
            <span class="icon" aria-hidden="true">
                <fa-icon [icon]="formIcons.reset"></fa-icon>
            </span>
            <span>Reset</span>
        </button>
        <div class="file">
            <label class="file-label">
                <input class="file-input" type="file" name="definition-upload"
                    accept=".csv,.tsv,text/csv,text/tab-separated-values " (input)="replaceFile($event)" />
                <span class="file-cta">
                    <span class="file-icon" aria-hidden="true">
                        <fa-icon [icon]="formIcons.replace"></fa-icon>
                    </span>
                    <span class="file-label">Replace file</span>
                </span>
            </label>
        </div>
        <button *ngIf="!fileConfirmed()" class="button is-primary" (click)="confirmFile()">
            <span class="icon" aria-hidden="true">
                <fa-icon [icon]="formIcons.confirm"></fa-icon>
            </span>
            <span>Use this file</span>
        </button>
    </div>
</ng-template>


<form *ngIf="(fileInfo$ | async) === undefined || (fileInfo$ | async) === null; else currentFileMenu">
    <div class="field">
        <div class="file">
            <label class="file-label">
                <input class="file-input" type="file" name="definition-upload"
                    accept=".csv,.tsv,text/csv,text/tab-separated-values " (input)="onUpload($event)" />
                <span class="file-cta">
                    <span class="file-icon" aria-hidden="true">
                        <fa-icon [icon]="actionIcons.upload"></fa-icon>
                    </span>
                    <span class="file-label">Upload CSV file...</span>
                </span>
            </label>
        </div>
    </div>

    <div class="message is-danger" *ngIf="error$ | async as error">
        <div class="message-header">
            Invalid file
        </div>
        <div class="message-body">
            An error occurred when reading the file: {{error.message}}
        </div>
    </div>


</form>
