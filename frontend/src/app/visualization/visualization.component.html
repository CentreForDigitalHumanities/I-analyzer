<div *ngIf="noVisualizations">
    <b> This corpus has no fields with associated visualizations. </b>
</div>

<div class="columns" *ngIf="!noVisualizations" #viscontrol>
    <div class="column">
        <div class="field" *ngIf="visDropdown">
            <label class="label">
                What do you want to visualise?
            </label>
            <div class="control">
                <ia-dropdown [options]="visDropdown" optionLabel="label" [value]="visualizationTypeDropdownValue"
                    (onChange)="changeVisualizationType($event.value)"></ia-dropdown>
            </div>
        </div>
    </div>

    <div class="column">
        <label class="field" *ngIf="fieldDropdown">
            <label class="label">
                <span *ngIf="visualizationType === 'resultscount' || visualizationType === 'termfrequency'">
                    Compare frequency by:
                </span>
                <span *ngIf="visualizationType === 'wordcloud' || visualizationType === 'ngram'">
                    Count frequencies in:
                </span>
            </label>
            <div class="control">
                <ia-dropdown  *ngIf="fieldDropdown.length > 1"  [options]="fieldDropdown" optionLabel="label" [value]="visualizedFieldDropdownValue"
                    (onChange)="changeVisualizedField($event.value)"></ia-dropdown>
                <input *ngIf="fieldDropdown.length === 1" class="input is-static" type="text" [value]="visualizedFieldDropdownValue.label">
            </div>
        </label>
    </div>

    <div class="column is-narrow">
        <div class="field has-addons">
            <!-- Buttons for switching between table and graphical representation -->
            <div class="control">
                <button class="button" [class.is-primary]="!freqtable" (click)="freqtable = false">
                    <fa-icon [icon]="icons.chart" aria-label="view chart"></fa-icon>
                </button>
            </div>
            <div class="control">
                <button class="button" [class.is-primary]="freqtable" (click)="freqtable = true">
                    <fa-icon [icon]="icons.table" aria-label="view table"></fa-icon>
                </button>
            </div>
        </div>
    </div>
</div>

<ng-container *ngIf="visualExists; else noVisualsMessage">
    <div class="block" [ngClass]="{'is-loading':isLoading}">
        <ng-container [ngSwitch]="visualizationType">
            <ng-container *ngSwitchCase="'resultscount'">
                <ia-timeline *ngIf="visualizedField.displayType === 'date'" [corpus]="corpus" [queryModel]="queryModel"
                [visualizedField]="visualizedField" [frequencyMeasure]="'documents'"
                [asTable]="freqtable" [palette]="palette"
                (isLoading)="onIsLoading($event)" (error)="setErrorMessage($event)"
                (totalTokenCountAvailable)="showTokenCountOption = $event"></ia-timeline>
            <ia-histogram *ngIf="visualizedField.displayType !== 'date'" [corpus]="corpus" [queryModel]="queryModel" [visualizedField]="visualizedField"
                [asTable]="freqtable" [palette]="palette"
                (isLoading)="onIsLoading($event)" (error)="setErrorMessage($event)"
                (totalTokenCountAvailable)="showTokenCountOption = $event"></ia-histogram>
            </ng-container>
            <ng-container *ngSwitchCase="'termfrequency'">
                <ia-timeline *ngIf="visualizedField.displayType === 'date'" [corpus]="corpus" [queryModel]="queryModel"
                    [visualizedField]="visualizedField" [frequencyMeasure]="'tokens'"
                    [asTable]="freqtable" [palette]="palette"
                    (isLoading)="onIsLoading($event)" (error)="setErrorMessage($event)"
                    (totalTokenCountAvailable)="showTokenCountOption = $event"></ia-timeline>
                <ia-histogram *ngIf="visualizedField.displayType !== 'date'" [corpus]="corpus" [queryModel]="queryModel" [visualizedField]="visualizedField"
                    [frequencyMeasure]="'tokens'"
                    [asTable]="freqtable" [palette]="palette"
                    (isLoading)="onIsLoading($event)" (error)="setErrorMessage($event)"
                    (totalTokenCountAvailable)="showTokenCountOption = $event"></ia-histogram>
            </ng-container>
            <ia-wordcloud *ngSwitchCase=" 'wordcloud' " [corpus]="corpus" [queryModel]="queryModel" [visualizedField]="visualizedField"
                [resultsCount]="resultsCount" [asTable]="freqtable" [palette]="palette"
                (isLoading)="onIsLoading($event)" (error)="setErrorMessage($event['message'])"></ia-wordcloud>
            <ia-ngram *ngSwitchCase=" 'ngram' " [corpus]="corpus" [queryModel]="queryModel" [visualizedField]="visualizedField"
                [asTable]="freqtable" [palette]="palette"
                (isLoading)="onIsLoading($event)" (error)="setErrorMessage($event)"></ia-ngram>
        </ng-container>
    </div>
</ng-container>

<ia-visualization-footer [tableView]="freqtable" [manualPage]="manualPage"
    [chartElementID]="chartElementId" [imageFileName]="imageFileName"
    (palette)="palette = $event">
</ia-visualization-footer>

<ng-template #noVisualsMessage>
    <b> {{foundNoVisualsMessage}} </b>
    <div class="container" *ngIf="errorMessage && errorMessage.length > 0">
        <div class="notification is-warning">
            {{errorMessage}}
        </div>
    </div>
</ng-template>
