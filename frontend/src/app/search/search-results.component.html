<ng-container *ngIf="results===undefined || !results.total; else resultsBlock">
    <h2 class="subtitle">
        0 hits
    </h2>
</ng-container>
<ng-template #resultsBlock>

    <div class="level">
        <h2 class="subtitle" *ngIf="results.total <= 5">
            {results.total.value, plural, =1 {1 hit} other {{{results.total.value}} hits}}
        </h2>
        <h2 class="subtitle" *ngIf="results.total.value > 5">
            {{results.total.value}} results.
            Showing results {{fromIndex+1}} - {{fromIndex+resultsPerPage > totalResults? totalResults : fromIndex+resultsPerPage}}:
        </h2>
        <ng-content *ngIf="!(queryText==null || queryText=='')" select="ia-highlight-selector"></ng-content>
    </div>

    <section class="section results-navigation" #resultsNavigation [ngClass]="{'is-scrolled-down': isScrolledDown}">

    <div class="level">

    <div class="level-left has-text-centered">
        <div>
            <p class="heading">Sort By</p>
            <ng-content select="ia-search-sorting"></ng-content>

        </div>
    </div>
    <div class="level-right has-text-centered" *ngIf="results.total.value > resultsPerPage" >
        <div>
            <p class="heading">Pages</p>
            <ia-pagination [totalResults]="totalResults" [fromIndex]="fromIndex" (loadResults)=loadResults($event)></ia-pagination>
        </div>
        </div>
    </div>
    </section>
    <div class="hits" [ngClass]="{'is-loading':isLoading}">
        <div *ngFor="let document of results.documents" class="document box" role="button">
            <div class="columns">
                <div class="column is-flex" (click)=onViewDocument(document)>
                    <table class="table is-fullwidth">
                        <ng-container *ngFor="let field of results.fields">
                            <tr *ngIf="document.fieldValues[field.name]">
                                <td>
                                    <b>{{field.displayName}}: </b>
                                </td>
                                <ng-container *ngIf="document.highlight && document.highlight[field.name]; else unhighlightedRow">
                                    <td>
                                        <ng-container *ngFor="let highlight of document.highlight[field.name]">
                                            <tr><div ngPreserveWhitespaces style="word-break:break-word" [innerHtml]="highlight"></div></tr>
                                        </ng-container>
                                    </td>
                                </ng-container>
                                <ng-template #unhighlightedRow>
                                    <td style="word-break:break-word" [innerHtml]="document.fieldValues[field.name] | highlight:query:true"></td>
                                </ng-template>
                            </tr>
                        </ng-container>
                    </table>
                </div>
                <div class="column is-one-quarter">
                    <ng-container *ngIf="document.relevance">
                        <div class="relevance-score">
                            <span>Relevance: {{document.relevance * 100 | number:'1.0-0' }}%</span>
                        </div>
                        <search-relevance [value]="document.relevance"></search-relevance>
                    </ng-container>
                    <button *ngIf="document.fieldValues.image_path" class="button scan-button is-primary is-inverted" iaBalloon="View Scan" (click)="goToScan(document, $event)">
                        <span class="icon">
                            <i class="fa fa-newspaper-o fa-3x" aria-hidden="true"></i>
                        </span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</ng-template>

<!-- show the selected document -->
<p-dialog header="Document {{viewDocument.position}} of {{totalResults}}" [(visible)]="showDocument" width="100%"
    [modal]="true" [responsive]="true" [maximizable]="true" [dismissableMask]="true" [draggable]="true" [resizable]="false" [blockScroll]="true"
    *ngIf="viewDocument">
    <ia-document-view [document]="viewDocument" [fields]="corpus.fields" [query]="queryText" [corpus]="corpus" [documentTabIndex]="documentTabIndex"></ia-document-view>
    <ng-template pTemplate="footer">
        <div class="columns" style="text-align:left">
            <div class="column">
                <a *ngIf="viewDocument && viewDocument.position > 1"
                    iaBalloon="view previous document" iaBalloonPosition="right"
                    (click)="prevDocument(viewDocument)" >
                    <span class="icon"><fa-icon [icon]="faArrowLeft">previous</fa-icon></span>
                </a>
            </div>
            <div class="column" style="text-align:right">
                <a *ngIf="viewDocument && viewDocument.position < totalResults"
                    iaBalloon="view next document" iaBalloonPosition="left"
                    (click)="nextDocument(viewDocument)">
                    <span class="icon"><fa-icon [icon]="faArrowRight">next</fa-icon></span>
                </a>
            </div>
        </div>
    </ng-template>
</p-dialog>

<ia-error *ngIf="showError" [showError]="showError"></ia-error>
