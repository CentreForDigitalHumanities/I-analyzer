<h2 class="title">
    Search results
</h2>
<ng-container *ngIf="results===undefined || !results.total; else resultsBlock">
    <h2 class="subtitle">
        0 hits
    </h2>
</ng-container>
<ng-template #resultsBlock>
    <h2 class="subtitle" *ngIf="results.total <= 5">
        {results.total, plural, =1 {1 hit} other {{{results.total}} hits}}
    </h2>
    <h2 class="subtitle" *ngIf="results.total > 5">
        {{results.total}} hits.
        <ng-container *ngIf="user.downloadLimit">
            Your download limit is {{user.downloadLimit}}.
        </ng-container>
        Showing {{results.documents.length}} results:
    </h2>
    <ng-content></ng-content>
    <nav class="pagination" role="navigation" aria-label="pagination">
        <a class="pagination-previous" aria-label="Previous page" (click)="loadResults(currentPage-1)" [attr.disabled]="currentPage==1? true : null">Previous</a>
        <a class="pagination-next" aria-label="Next page" (click)="loadResults(currentPage+1)" [attr.disabled]="currentPage==totalPages? true : null">Next page</a>
        <ul class="pagination-list">
            <li *ngIf="currentPages[0]>1">
                <a class="pagination-link" (click)="loadResults(1)" aria-label="Goto page 1">1</a>
            </li>
            <li *ngIf="currentPages[0]>2">
                <span class="pagination-ellipsis">&hellip;</span>
            </li>
            <li>
                <a [ngClass]="{'is-current': currentPages[0]==1 && !isMediumPage}" class="pagination-link" (click)="loadResults(currentPages[0])">{{currentPages[0]}}</a>
            </li>
            <li>
                <a [ngClass]="{'is-current': isMediumPage}" class="pagination-link" (click)="loadResults(currentPages[1])">{{currentPages[1]}}</a>
            </li>
            <li>
                <a [ngClass]="{'is-current': currentPages[2]==totalPages && !isMediumPage}" class="pagination-link" (click)="loadResults(currentPages[2])">{{currentPages[2]}}</a>
            </li>
            <li *ngIf="currentPages[2]<totalPages-1">
                <span class="pagination-ellipsis">&hellip;</span>
            </li>
            <li *ngIf="currentPages[2]<totalPages">
                <a class="pagination-link" aria-label="Goto last page" (click)="loadResults(totalPages)">{{totalPages}}</a>
            </li>
        </ul>
      </nav>
    <div class="hits" [ngClass]="{'is-loading':isLoading}">
        <div *ngFor="let document of results.documents" class="document box" (click)="view(document)" role="button">
            <div class="columns is-gapless">
                <div class="column  is-flex">  
                    <table class="table is-fullwidth">
                        <ng-container *ngFor="let field of results.fields">
                            <tr *ngIf="document.fieldValues[field.name]">
                                <td>
                                    <b>{{field.displayName}}: </b>
                                </td>
                                <td style="word-break:break-word" [innerHtml]="document.fieldValues[field.name] | highlight:query:true"></td>
                            </tr>
                        </ng-container>
                    </table>
                </div>  
                <div class="column is-one-quarter is-centered" *ngIf="document.relevance">
                    <div class="relevance-score">
                        <span>Relevance: {{document.relevance * 100 | number:'1.0-0' }}%</span>
                    </div>
                    <search-relevance [value]="document.relevance"></search-relevance>
                    <img *ngIf="corpus.scan_image_type=='png'" class="src-thumbnail" src="/api/get_scan_image/{{corpus.index}}/{{document.fieldValues.image_path}}" onerror="this.style.display='none'"/>
                </div>
                
            </div>
            
        </div>
        
    </div>
    <div class="levels load-more" *ngIf="results.total > 5">
        <div class="level-item buttons" *ngIf="!results.completed">
            <span class="button is-primary" [ngClass]="{'is-loading': isLoadingMore}" (click)="loadMore()">Load more</span>
        </div>
        <div class="level-item buttons" *ngIf="results.completed">
            <em *ngIf="results.total == results.retrieved">{results.total, plural, other {Retrieved all {{results.total}} results.}}</em>
            <em *ngIf="results.total > results.retrieved">{results.retrieved, plural, other {Results limited to {{results.retrieved}} results.}}</em>
        </div>
    </div>
</ng-template>
<!-- inform the user about a failed search -->
<p-dialog [(visible)]="showError" width="600" *ngIf="showError">
    <p-header>Unfortunately, we couldn&rsquo;t complete your request</p-header>
    <div class="content">
        <p>Please try again later, or seek support if the problem persists. In order to help us help you, please provide the
            following information when seeking support:</p>
        <table>
            <tbody>
                <tr>
                    <th>Date</th>
                    <td>
                        <code>{{showError.date}}</code>
                    </td>
                </tr>
                <tr>
                    <th>URL</th>
                    <td>
                        <code>{{showError.href}}</code>
                    </td>
                </tr>
                <tr>
                    <th>Error</th>
                    <td>
                        <code>{{showError.message}}</code>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</p-dialog>
