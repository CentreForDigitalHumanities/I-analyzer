<ng-container *ngIf="pageResults?.result$ | async as page; else loading">
    <section class="section results-navigation" #resultsNavigation [ngClass]="{'is-scrolled-down': isScrolledDown}">
        <div class="level">
            <h2 class="subtitle" *ngIf="page.total <= 5">
                {page.total, plural, =1 {1 hit} other {{{page.total}} hits}}
            </h2>
            <h2 class="subtitle" *ngIf="page.total > 5">
                {{page.total}} results.
                Showing results {{(pageResults.from$ | async) + 1}}
                -
                {{(pageResults.to$ | async)}}
            </h2>
            <ia-highlight-selector *ngIf="!!queryModel.queryText" [queryModel]="queryModel"></ia-highlight-selector>
        </div>

        <div class="level">
            <h2 class="subtitle" *ngIf="page.total <= 5">
                {page.total, plural, =1 {1 hit} other {{{page.total}} hits}}
            </h2>
            <h2 class="subtitle" *ngIf="page.total > 5">
                {{page.total}} results.
                <!-- Showing results {{fromIndex+1}} - {{fromIndex+resultsPerPage > totalResults? totalResults : fromIndex+resultsPerPage}}: -->
            </h2>
            <ng-content *ngIf="!(queryText===null || queryText==='')" select="ia-highlight-selector"></ng-content>
        </div>

        <div class="level">
            <div class="level-left has-text-centered">
                <div>
                    <p class="heading">Sort By</p>
                    <ia-search-sorting [queryModel]="queryModel"></ia-search-sorting>
                </div>
            </div>
            <div class="level-right has-text-centered" *ngIf="page.total > resultsPerPage" >
                <div>
                    <p class="heading">Pages</p>
                    <ia-pagination [totalResults]="page.total" [fromIndex]="pageResults.from$ | async" (parameters)="setParameters($event)"></ia-pagination>
                </div>
            </div>
        </div>
    </section>

    <section *ngIf="page.documents.length; else noResults" aria-label="search results">
        <div class="hits" [ngClass]="{'is-loading':isLoading}">
            <article *ngFor="let document of page.documents" class="document box">
                <div class="columns">
                    <div class="column is-flex" tabindex="0" role="button"
                        (click)="page.focus(document)"
                        (keydown.enter)="page.focus(document)">
                        <table class="table is-fullwidth">
                            <ng-container *ngFor="let field of page.fields">
                                <tr *ngIf="document.fieldValue(field)">
                                    <td>
                                        <b>{{field.displayName}}: </b>
                                    </td>
                                    <ng-container *ngIf="document.highlight && document.highlight[field.name]; else unhighlightedRow">
                                        <td>
                                            <ng-container *ngFor="let highlight of document.highlight[field.name]">
                                                <div ngPreserveWhitespaces style="word-break:break-word" [innerHtml]="highlight"></div>
                                                 insert ellipsis [...] in between snippets or at the end of a single snippet
                                                <hr *ngIf="highlight !== document.highlight[field.name][document.highlight[field.name].length-1]">
                                            </ng-container>
                                        </td>
                                    </ng-container>
                                    <ng-template #unhighlightedRow>
                                        <td style="word-break:break-word" [innerHtml]="document.fieldValue(field) | highlight:query:true"></td>
                                    </ng-template>
                                </tr>
                            </ng-container>
                        </table>
                    </div>
                    <div class="column is-one-quarter">
                        <ng-container *ngIf="document.relevance">
                            <div class="relevance-score">
                                <span>Relevance: {{document.relevance * 100 | number:'1.0-0' }}%</span>
                            </div>
                            <search-relevance [value]="document.relevance"></search-relevance>
                        </ng-container>
                        <button *ngIf="document.fieldValues.image_path" class="button scan-button is-primary is-inverted" iaBalloon="View Scan" (click)="goToScan(document, $event)">
                            <span class="icon">
                                <i class="fa fa-newspaper-o fa-3x" aria-hidden="true"></i>
                            </span>
                        </button>
                    </div>
                </div>
            </article>
        </div>
    </section>

    <ia-document-popup [page]="page" [queryModel]="queryModel"></ia-document-popup>
</ng-container>

<ng-template #loading>
    <div class="is-loading" aria-label="loading results"></div>
</ng-template>

<ng-template #noResults>
    <section aria-label="search results">
        No results
    </section>
</ng-template>

<!-- <ia-error *ngIf="showError" [showError]="showError"></ia-error> -->
